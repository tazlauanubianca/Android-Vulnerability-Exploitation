#!/usr/bin/env bash

APK="base.apk"
NAME="base"

# Decompile
java -jar apktool_2.3.4.jar d $APK

# Insert malicious code ...

# Compile
java -jar apktool_2.3.4.jar b $NAME -o $APK

# Sign
java -jar uber-apk-signer-1.1.0.jar --debug -a $APK --overwrite --allowResign

# Check for Manifest file
if [ ! -f $NAME/AndroidManifest.xml ]; then echo "AndroidManifest.xml not found"; exit 1; fi

# Change package name
sed 's/package="com.skibapps.wiretapremoval"/package="com.skibbapps.wiretapremoval"/g' -i $NAME/AndroidManifest.xml
